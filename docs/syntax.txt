; Syntax of this file:
; expression_name syntax_level token_list
; expression_name must be a single word
; syntax_level must be a number:
; 	-1 for messages to/from any client
; 	 N for messages to/from players at syntax level >= N
; 	-N for items that will be automatically removed at syntax level < N
; token_list is a space-separated list of any of the following:
; 	TOK: the token of that name
; 	[expression_name]: anything allowed in that expression
; 	[repeat] expression: any number of such expressions
; 	[sub expression_name]: one expression, wrapped in parentheses
; 	[cat category]: any token in the specified category
; 		(as specified in the DSCP file,
; 		with spaces replaced by underscores)


; Generic expressions
string      -1 [repeat] [cat Text]
power       -1 [cat Powers]
power_list  -1 [repeat] [power]
maybe_power -1 [power]
maybe_power -1 UNO						; For supply center distribution
maybe_power -1 OBS						; For HLO messages
turn        -1 [cat Phases] [number]
number      -1 [cat Integers]
order_note  -1 [cat Order_Notes]
draw        -1 DRW
draw        -1 DRW [sub power_list]		; Mostly for PDA mode

; Provinces
province             -1 [cat Provinces]
sc_province          -1 [cat Sea_SC]
sc_province          -1 [cat Inland_SC]
sc_province          -1 [cat Coastal_SC]
sc_province          -1 [cat Bicoastal_SC]
non_sc_province      -1 [cat Sea_non-SC]
non_sc_province      -1 [cat Inland_non-SC]
non_sc_province      -1 [cat Coastal_non-SC]
non_sc_province      -1 [cat Bicoastal_non-SC]
sea_province         -1 [cat Sea_SC]
sea_province         -1 [cat Sea_non-SC]
sea_province_list    -1 [repeat] [sea_province]
bicoastal_province   -1 [cat Bicoastal_SC]
bicoastal_province   -1 [cat Bicoastal_non-SC]
coastal_province     -1 [cat Coastal_SC]
coastal_province     -1 [cat Coastal_non-SC]
coastal_province     -1 [bicoastal_province]
province_maybe_coast -1 [province]
province_maybe_coast -1 [sub province_with_coast]
province_with_coast  -1 [bicoastal_province] [cat Coasts]
province_list        -1 [repeat] [province]
sc_dist              -1 [maybe_power]
sc_dist              -1 [maybe_power] [repeat] [sc_province]

; Units
ordered_unit       -1 [sub unit_maybe_coast]
unit_maybe_coast   -1 [power] [cat Unit_Types] [province_maybe_coast]
unit_maybe_retreat -1 [unit_maybe_coast]
unit_maybe_retreat -1 [unit_retreat]
unit_retreat       -1 [unit_maybe_coast] MRT [sub retreat_list]
retreat_list       -1 [optional repeat] [province_maybe_coast]



; Commands from clients
client_command -1 [client_rejectable]
client_command -1 REJ [sub server_rejectable]
client_command -1 YES [sub server_acceptable]
client_command -1 MAP
client_command -1 MDF

; Client commands that can recieve YES responses
client_acceptable -1 IAM [sub power] [sub number]
client_acceptable -1 NOT [sub client_negatable]
client_acceptable -1 NME [sub string] [sub string]
client_acceptable -1 OBS
client_acceptable -1 PNG [sub any]
client_acceptable -1 SEL [sub game_id]
client_acceptable -1 TME [sub number]
client_acceptable  0 [draw]
client_acceptable  0 GOF
client_acceptable 10 SND [sub number] [sub power_list] [press]

game_id -1 [number]
; game_id -1 [string]
press 10 [sub message]
press 10 [sub any_message] WRT [repeat] [sub message_id]
any_message 10 [reply]
any_message 10 [message]
message_id  10 [power] [number]

; Client commands which can start with NOT()
client_negatable -1 TME [optional sub number]
client_negatable  0 [draw]
client_negatable  0 GOF
client_negatable  0 SUB [optional sub order]


; Client commands that can recieve REJ responses
client_rejectable -1 [client_acceptable]
client_rejectable -1 ADM [sub string] [sub string]
client_rejectable -1 HLO
client_rejectable -1 HST [sub turn]
client_rejectable -1 HST
client_rejectable -1 NOW
client_rejectable -1 ORD
client_rejectable -1 SCO
client_rejectable -1 TME
client_rejectable  0 MIS
client_rejectable  0 SUB [repeat] [sub order]



; Commands from the server
server_rejectable -1 [server_acceptable]
server_rejectable -1 LOD [sub string] ; Note: YES might be a proper response to this, for observers.  Check with list.
server_acceptable -1 MAP [sub string]
server_acceptable -1 SVE [sub string]
server_acceptable -1 PNG [sub any]
server_negatable  -1 CCD [sub power]
server_negatable  -1 TME [sub number] ; For DSD

server_command    -1 [draw]
server_command    -1 [server_negatable]
server_command    -1 [server_rejectable]
server_command    -1 ADM [sub string] [sub string]
server_command    -1 HLO [sub maybe_power] [sub number] [sub variant_list]
server_command    -1 HUH [sub any]
server_command    -1 NOT [sub server_negatable]
server_command    -1 NOW [sub turn] [repeat] [sub unit_maybe_retreat]
server_command    -1 OFF
server_command    -1 ORD [sub turn] [sub order] [sub order_result]
server_command    -1 OUT [sub power]
server_command    -1 PRN [sub any]
server_command    -1 REJ [sub client_rejectable]
server_command    -1 SCO [repeat] [sub sc_dist]
server_command    -1 SLO [sub power]
server_command    -1 SMR [sub turn] [repeat] [sub power_summary]
server_command    -1 YES [sub client_acceptable]

; Server commands sent only to players
server_command  0 MIS [repeat] [sub unit_maybe_coast]
server_command  0 MIS [repeat] [sub unit_retreat]
server_command  0 MIS [sub number]
server_command  0 THX [sub order] [sub order_note]
server_command 10 FRM [sub message_id] [sub power_list] [press]

power_summary -1 [power] [sub string] [sub string] [number] [optional number]

; Map definition message
server_command    -1 MDF [sub power_list] [sub mdf_provinces] [sub mdf_adjacencies]
mdf_provinces     -1 [sub mdf_sc_list] [sub mdf_non_sc_list]
mdf_sc_list       -1 [repeat] [sub mdf_supply_centre]
mdf_supply_centre -1 [sc_dist]
mdf_supply_centre -1 [sub power_list] [repeat] [province]
mdf_non_sc_list   -1 [repeat] [non_sc_province]
mdf_adjacencies   -1 [repeat] [sub prov_adjacency]
prov_adjacency    -1 [province] [repeat] [sub unit_adjacency]
unit_adjacency    -1 AMY
unit_adjacency    -1 [cat Unit_Types] [repeat] [province_maybe_coast]
unit_adjacency    -1 [sub unit_coast] [repeat] [province_maybe_coast]
unit_coast        -1 FLT [cat Coasts]

; For the HLO message
variant_list -1 [sub syntax_level]
variant_list -1 [sub syntax_level] [repeat] [sub variant]
syntax_level -1 LVL [number]
variant -1 MTL [number]			; Movement Time Limit
variant -1 RTL [number]			; Retreat Time Limit
variant -1 BTL [number]			; Builds Time Limit
variant -1 AOA				; Any Orders Accepted
variant -1 DSD				; Deadline Stops on Disconnection
variant -1 PDA				; Partial Draws Allowed
variant -1 PTL [number]			; Press Time Limit before deadline
variant -1 NPR				; No Press during Retreats
variant -1 NPB				; No Press during Builds



; Orders
order -1 [ordered_unit] HLD
order -1 [ordered_unit] MTO [province_maybe_coast]
order -1 [ordered_unit] SUP [ordered_unit]
order -1 [ordered_unit] SUP [ordered_unit] MTO [province]
;order -1 [ordered_unit] CVY [ordered_unit] CTO [coastal_province]
;order -1 [ordered_unit] CTO [coastal_province] VIA [sub sea_province_list]
order -1 [ordered_unit] RTO [province_maybe_coast]
order -1 [ordered_unit] DSB
order -1 [ordered_unit] BLD
order -1 [ordered_unit] REM
order -1 [power] WVE

; Less strict: order notes will catch these mistakes.
order -1 [ordered_unit] CVY [ordered_unit] CTO [province]
order -1 [ordered_unit] CTO [province] VIA [sub province_list]


; Order results
order_result       -1 [cat Results]
order_result       -1 [retreatable_result] RET
order_result       -1 [order_note]		; Mostly for AOA mode
order_result       -1 [order_note] RET
retreatable_result -1 SUC
retreatable_result -1 BNC
retreatable_result -1 CUT
retreatable_result -1 DSR
retreatable_result -1 NSO

; Press Messages
message 10 PRP [sub main_offer]
message 10 TRY [sub try_contents]
message 60 INS [sub main_offer]
message 60 SUG [sub main_offer]
message 60 [query]
message 60 [thought]
message 70 [help_request]
message 80 [explain]
message 100 IFF [sub condition] THN [sub message] [optional] ELS [sub message]
message 120 FRM [sub power] [sub power_list] [sub message]
message 8000 [string]

thought 60 THK [sub main_offer]
thought 60 FCT [sub main_offer]

query 60 QRY [sub main_offer]
maybe_query 60 [query]
maybe_query 60 NOT [sub query]

help_request 70 WHT [sub unit_maybe_coast]
help_request 70 HOW [sub province_maybe_coast]
help_request 70 HOW [sub power]

explain 80 EXP [sub turn] [sub message]

condition 100 [offer]
condition 100 AND [sub condition] [sub condition]
condition 100 ORR [sub condition] [sub condition]
condition 100 NOT [sub condition]


; Press Replies
reply 10 YES [sub message]
reply 10 REJ [sub message]
reply 10 BWX [sub message]
reply 10 HUH [sub any]
reply 60 THK [sub maybe_query]
reply 60 FCT [sub maybe_query]
reply 60 IDK [sub query]
reply 70 IDK [sub help_request]
reply 80 SRY [sub explain]
reply 130 POB [sub elucidate]
reply 130 [elucidate]
; reply 130 IDK [sub message]

; elucidate 130 WHY [sub message]
elucidate 130 WHY [sub thought]


; Press offers
main_offer 10 [offer]
main_offer 30 [multipart_offer]
offer 10 PCE [sub power_list]
offer 10 ALY [sub power_list] VSS [sub power_list]
offer 10 [draw]
offer 10 SLO [sub power]
offer 10 NOT [sub offer]
offer 20 XDO [sub order]
offer 20 DMZ [sub power_list] [sub province_list]
offer 40 SCD [repeat] [sub sc_dist]
offer 40 OCC [repeat] [sub unit_maybe_coast] ; How to allow UNT here?
offer 50 [multipart_offer]
offer 90 FOR [sub turn_range] [sub offer]
; offer 110 IOU
; offer 110 UOM
offer 110 XOY [sub power] [sub power]
offer 110 YDO [sub power] [repeat] [sub unit_maybe_coast]
; offer 110 PPT [sub power] [sub power] [optional sub promise_list]
offer 120 SND [sub power] [sub power_list] [sub message]
offer 120 FWD [sub power_list] [sub power_list] [sub power]
; offer 120 BCC [sub power_list] [sub power_list] [sub power]

multipart_offer 30 AND [repeat] [sub offer]
multipart_offer 30 ORR [repeat] [sub offer]
multipart_offer 50 CHO [sub num_range] [repeat] [sub offer]
num_range 50 [number] [optional number]

turn_range 90 [sub turn] [sub turn]
turn_range 90 [turn]

promise_list 110 [repeat] [promise]
promise 110 XDO
promise 110 SCD
promise 120 SND
promise 120 FRM

try_contents 10 [optional repeat] [press_token]

press_token 10 PRP
press_token 10 PCE
press_token 10 ALY
press_token 10 VSS
press_token 10 DRW
press_token 10 SLO
press_token 10 NOT
press_token 10 YES
press_token 10 REJ
press_token 10 BWX
press_token -20 XDO
press_token -20 DMZ
press_token -30 AND
press_token -30 ORR
press_token -50 CHO
press_token -40 SCD
press_token -40 OCC
press_token -60 INS
press_token -60 QRY
press_token -60 THK
press_token -60 FCT
press_token -60 IDK
press_token -60 SUG
press_token -70 WHT
press_token -70 HOW
press_token -80 EXP
press_token -80 SRY
press_token -90 FOR
press_token -100 IFF
press_token -100 THN
press_token -100 ELS
; press_token -110 IOU
; press_token -110 UOM
press_token -110 XOY
press_token -110 YDO
; press_token -110 PPT
press_token -120 FRM
press_token -120 FWD
; press_token -120 BCC
press_token -120 SND



; Variations on orders.
; New server command
server_command    -1 SET [sub turn] [sub power] [optional repeat] [sub order_with_note]
order_with_note   -1 [sub order] [sub order_note]

; These are slightly different than normally allowed,
; but necessary to support certain movement rule interpretations.
{alt-input} order -1 [ordered_unit] CTO [coastal_province]		; Move by convoy order, without route
{alt-input} order -1 [ordered_unit] SUP [ordered_unit] MTO [sub province_with_coast]	; Support to move, to a specific coast

; Accept unambiguous orders from clients, but don't broadcast them.
{non-strict} order            0 WVE						; Waive order without power.
{non-strict} ordered_unit     0 [province_maybe_coast]				; Province as a unit
{non-strict} unit_maybe_coast 0 [cat Unit_Types] [province_maybe_coast]		; A unit without no power specified
{non-strict} unit_maybe_coast 0 [power] [province_maybe_coast]			; A unit without no type specified
{non-strict} unit_maybe_coast 0 [province_maybe_coast]				; A unit without no type or power specified
